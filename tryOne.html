<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #map {
        height: 100%;
      }
    </style>
	
	<script>

var riverThamesCoordinates = [{
		lat : 51.384283,
		lng : -0.435548
	}, {
		lat : 51.387551,
		lng : -0.430999
	}, {
		lat : 51.388300,
		lng : -0.426192
	}, {
		lat : 51.405159,
		lng : -0.408533
	}, {
		lat : 51.409549,
		lng : -0.388877
	}, {
		lat : 51.408024,
		lng : -0.377591
	}, {
		lat : 51.411959,
		lng : -0.360296
	}, {
		lat : 51.391825,
		lng : -0.327981
	}, {
		lat : 51.393271,
		lng : -0.318539
	}, {
		lat : 51.401759,
		lng : -0.308754
	}, {
		lat : 51.421353,
		lng : -0.305622
	}, {
		lat : 51.428765,
		lng : -0.315406
	}, {
		lat : 51.433314,
		lng : -0.327594
	}, {
		lat : 51.441339,
		lng : -0.331113
	}, {
		lat : 51.452279,
		lng : -0.303004
	}, {
		lat : 51.465114,
		lng : -0.320556
	}, {
		lat : 51.471316,
		lng : -0.318024
	}, {
		lat : 51.475914,
		lng : -0.306394
	}, {
		lat : 51.486978,
		lng : -0.288713
	}, {
		lat : 51.481393,
		lng : -0.276139
	}, {
		lat : 51.471877,
		lng : -0.267556
	}, {
		lat : 51.472359,
		lng : -0.254166
	}, {
		lat : 51.485829,
		lng : -0.247600
	}, {
		lat : 51.488983,
		lng : -0.231593
	}, {
		lat : 51.468830,
		lng : -0.217817
	}, {
		lat : 51.466344,
		lng : -0.184214
	}, {
		lat : 51.481687,
		lng : -0.173614
	}, {
		lat : 51.485936,
		lng : -0.127738
	}, {
		lat : 51.509100,
		lng : -0.117953
	}, {
		lat : 51.506028,
		lng : -0.074179
	}, {
		lat : 51.501059,
		lng : -0.058773
	}, {
		lat : 51.508993,
		lng : -0.037401
	}, {
		lat : 51.502502,
		lng : -0.027959
	}, {
		lat : 51.488475,
		lng : -0.028045
	}, {
		lat : 51.484012,
		lng : -0.011952
	}, {
		lat : 51.492991,
		lng : 0.001395
	}, {
		lat : 51.506135,
		lng : -0.003154
	}, {
		lat : 51.496143,
		lng : 0.022724
	}, {
		lat : 51.498281,
		lng : 0.077140
	}
];
	var latlng = [];
	var bikeGeoLocationAndName = [];
function initMap() {
	var map;

	var london = {
		lat : 51.5072,
		lng : 0.1275
	};
	map = new google.maps.Map(document.getElementById('map'), {
			center : london,
			zoom : 10,
			mapTypeId : google.maps.MapTypeId.ROADMAP
		});

	httpGetAsync("https://api.tfl.gov.uk/BikePoint", function locationApi(response) {
		for (var i = 0; i < response.length; i++) {
			bikeGeoLocationAndName[i] = [];
			bikeGeoLocationAndName[i][0] = response[i].commonName;
			bikeGeoLocationAndName[i][1] = response[i]["lat"];
			bikeGeoLocationAndName[i][2] = response[i]["lon"];
		}

		bikeGeoLocationAndName.push.apply(bikeGeoLocationAndName, latlng);

		new google.maps.Polyline({
			path : riverThamesCoordinates,
			geodesic : true,
			strokeColor : '#000000',
			strokeOpacity : 1.0,
			strokeWeight : 5,
			map : map
		});

		var infowindow = new google.maps.InfoWindow();

		var x = 0,
		j = 0;

		var flag = false;
		for (; x < bikeGeoLocationAndName.length; x++) {

			for (; j < (riverThamesCoordinates.length- 1); j++) {
				if (riverThamesCoordinates[j].lat > bikeGeoLocationAndName[x][1]) {
					flag = true;
				}
			}
			j = 0;
			if (flag) {
				var marker = new google.maps.Marker({
						position : new google.maps.LatLng(bikeGeoLocationAndName[x][1], bikeGeoLocationAndName[x][2]),
						map : map,
						icon : "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
					});
				flag = false;
			} else {
				var marker = new google.maps.Marker({
						position : new google.maps.LatLng(bikeGeoLocationAndName[x][1], bikeGeoLocationAndName[x][2]),
						map : map
					});
			}
			google.maps.event.addListener(marker, 'click', (function (marker, x) {
					return function () {
						infowindow.setContent(bikeGeoLocationAndName[x][0]);
						infowindow.open(map, marker);
					}
				})(marker, x));
		}
	});
}
	function myFunction(arr) {
		var i;
		for (i = 0; i < arr.length; i++) {
			latlng[i] = [];
			latlng[i][0] = arr[i].title;
			latlng[i][1] = arr[i].lat;
			latlng[i][2] = arr[i].lng;
		}
	}

	function httpGetAsync(theUrl, callback) {
		var xmlHttp = new XMLHttpRequest();
		xmlHttp.open("GET", theUrl, true); // true for asynchronous
		xmlHttp.send(null);

		xmlHttp.onreadystatechange = function () {
			if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
				callback(JSON.parse(xmlHttp.responseText));
		}
	}
 </script>
	   <script src="locations.js"></script>	   
	   <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBWRXBeHNcEtZPVwFOvbYvUgGSTV1sAbbE&callback=initMap"async defer></script>
  </head>
  <body>
    <div id="map"></div>
  </body>
</html>